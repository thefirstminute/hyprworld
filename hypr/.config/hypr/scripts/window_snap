#!/bin/bash

POS=$1

# Get active window JSON
AW=$(hyprctl activewindow -j)

# Early exit if no active window
if [ -z "$AW" ] || [ "$(echo "$AW" | jq '.monitor')" = "-1" ]; then
  echo "No active window"
  exit 1
fi

# Float if not already floating (required for movewindowpixel/resizewindowpixel)
FLOATING=$(echo "$AW" | jq '.floating')
if [ "$FLOATING" = "false" ]; then
  hyprctl dispatch togglefloating
  # Refetch AW after toggle, as state has changed
  AW=$(hyprctl activewindow -j)
fi

# Get monitor ID
MON_ID=$(echo "$AW" | jq '.monitor')

# Get monitors JSON
MONS=$(hyprctl monitors -j)

# Get current monitor
CM=$(echo "$MONS" | jq ".[] | select(.id == $MON_ID)")

MW=$(echo "$CM" | jq '.width')
MH=$(echo "$CM" | jq '.height')

# Get window current width/height
WW=$(echo "$AW" | jq '.size[0]')
WH=$(echo "$AW" | jq '.size[1]')

# Defaults
TX=0
TY=0
RESIZE=false

case $POS in
  7) # Top-left
    TX=0
    TY=0
    ;;
  8) # Top-center
    TX=$(( (MW - WW) / 2 ))
    TY=0
    ;;
  9) # Top-right
    TX=$(( MW - WW ))
    TY=0
    ;;
  4) # Left full-height (special: resize to half-width, full-height)
    TX=0
    TY=0
    NEW_WW=$(( MW / 2 ))
    NEW_WH=$MH
    RESIZE=true
    ;;
  5) # Center
    TX=$(( (MW - WW) / 2 ))
    TY=$(( (MH - WH) / 2 ))
    ;;
  6) # Right full-height (special: resize to half-width, full-height)
    TX=$(( MW / 2 ))
    TY=0
    NEW_WW=$(( MW / 2 ))
    NEW_WH=$MH
    RESIZE=true
    ;;
  1) # Bottom-left
    TX=0
    TY=$(( MH - WH ))
    ;;
  2) # Bottom-center
    TX=$(( (MW - WW) / 2 ))
    TY=$(( MH - WH ))
    ;;
  3) # Bottom-right
    TX=$(( MW - WW ))
    TY=$(( MH - WH ))
    ;;
esac

if [ "$RESIZE" = true ]; then
  hyprctl dispatch resizewindowpixel exact "$NEW_WW" "$NEW_WH"
fi

hyprctl dispatch movewindowpixel exact "$TX" "$TY"
